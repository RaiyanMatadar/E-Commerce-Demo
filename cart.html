<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <div>
        <h1>This is cart page</h1>
        <!-- <button class="btn btn-primary">Go back</button> -->
    </div>

    <div class="parent mt-5">

    </div>

    <script>
        // localStorageArr has the mycart key from the localStorage 
        let localStorageArr = JSON.parse(localStorage.getItem('mycart'));

        async function fetchData(obj) {
            try {
                let res = [];
                console.log("fetchData called ");
                for (let element of obj) {
                    let {
                        id,
                        productQty
                    } = element
                    const response = await fetch(`https://fakestoreapi.com/products/${id}`);
                    let data = await response.json()
                    res.push(data)
                }
                ShowDataFetchedData(res);

            } catch (error) {
                console.log(error);
            }
        }

        fetchData(localStorageArr)

        function ShowDataFetchedData(arr) {
            console.log("ShowDataFetchedData called");
            const parent = document.getElementsByClassName('parent')[0];

            arr.forEach((element, index) => {

                const div = document.createElement("div");

                let {
                    title,
                    image,
                    price,
                    rating: {
                        rate,
                        count
                    },
                    id,
                    category
                } = element;

                div.classList.add("box")

                div.innerHTML = `
                <img src="${image}" alt="">
                <p>${category}</p>
                <p>${price}</p>
                <span>${rate}</span>
                <p>${title}</p>
                <div class="d-flex justify-content-center gap-2">
                <button class="btn btn-primary" onclick="decreamentQty(${id},${index})">-</button>
                <p class="quantity">${localStorageArr[index].productQty}</p>
                <button class="btn btn-primary" onclick="incrementQty(${id}, ${index})">+</button>
                </div>
                `
                parent.appendChild(div)
            });
        }

        // this will increment the quntity of the product and store it into the value of the product 
        function incrementQty(id, i) {
            let quantities = document.querySelectorAll(".quantity")
            localStorageArr[i].productQty += 1

            quantities[i].innerHTML = localStorageArr[i].productQty
            localStorage.setItem("mycart", JSON.stringify(localStorageArr))
        }


        // this will decrement the quntity of the product and store it into the value of the product 
        function decreamentQty(id, i) {
            let quantities = document.querySelectorAll(".quantity")
            if (localStorageArr[i].productQty > 1) {
                localStorageArr[i].productQty -= 1

                quantities[i].innerHTML = localStorageArr[i].productQty
                localStorage.setItem("mycart", JSON.stringify(localStorageArr))
            }
        }
    </script>
</body>

</html>